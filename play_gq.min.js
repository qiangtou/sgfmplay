(function(d,w){var e=w.sgfmmvc=w.sgfmmvc||{},z=0;e.Model=function(c){c=c||{};var b=c.defaults||{};this.idArr="id";this.hasChange=d.noop;this.get=function(h){return b[h]};this.getAttrs=function(){return b};this.reset=function(h){b={};return this.set(h)};this.change=function(){};var e=function(h,g){if(h){var c,e,d,y=!1;"string"==typeof h?(c={})[h]=g:c=h;for(var q in c)e=b[q],d=c[q],e!=d&&(b[q]=d,y=!0,this.change(q,e,d));y&&this.hasChange.call(this);return this}};this.set=function(h,b){return e.call(this,
h,b)};this.update=function(b,g){return e.call(this,b,g)};this.fetch=function(b){var g=this,c=this.url,e=b||function(b){this.set(b)};c&&d.ajax({url:c,success:function(c){"function"==typeof b&&e.call(g,c)},dataType:"json"})};d.extend(this,c);b[this.idArr]||(b[this.idArr]=z++)};e.Models=function(c){var b={};this.length=0;this.model=null;this.init=d.noop;this.create=function(b){b=new this.model({defaults:b});return e.call(this,b)};var e=function(c){var g=c.get(c.idArr);b[g]||(b[g]=c,this.length++);return c};
this.add=function(b){return e.call(this,b)};this.del=function(c){c=c.get(c.idArr);b[c]&&(delete b[c],this.length--);return this};this.empty=function(){b={};this.length=0};this.toArr=function(){var c=[],g;for(g in b)c.push(b[g]);return c};this.getById=function(c){return b[c]};this.get=function(c){var g=0;for(m in b)if(g++,g==c)return b[m]};this.reset=function(c){this.empty();for(var b=c.length;b--;)this.create(c[b]);return this};this.fetch=function(c){var b=this,e=this.url;e&&d.ajax({url:e,success:function(e){"function"==
typeof c&&c.call(b,e)},dataType:"json"})};d.extend(this,c);this.init.call(this,c)};e.View=function(c){var b=this,e={},h={};this.init=d.noop;this.$=d("<div></div>");this.render=d.noop;this.events={};this.show=function(){return this.$.show()};this.hide=function(){return this.$.hide()};this.listenTo=function(c,j,t){if(c){var k,x;k=j.split(":");j=k[0];"change"==j&&(k=k[1])&&(h[k]=t);x=e[j]||(e[j]=c[j])||d.noop;c[j]=function(){var e,d;d=arguments[0];e=x.apply(c,arguments);(d="change"==j?h[d]:t)&&d.apply(b,
arguments);return e}}};this.addEvents=function(){var c,b,e,d,h=this.events;for(e in h)c=e.split(" "),b=c[0],c=c[1],d=h[e],"string"==typeof d&&(d=this[d]),this.$.delegate(b,c,{view:this},d)};this._init=function(){d.extend(b,c);var e=this.tag;e&&(this.$=d("<"+e+"></"+e+">"));(e=this.cls)&&this.$.addClass(e);this.init.call(this,c);this.addEvents.call(this,c)};this._init()};e.Model.extend=e.Models.extend=e.View.extend=function(c){var b=this;return function(e){return new b(d.extend(c,e))}};e.replace=function(c,
b){if(!b||!c)return"";b instanceof e.Model&&(b=b.getAttrs());return c.replace(/{(.*?)}/igm,function(c,e){var d=b[e];return void 0!=d?d:""})}})(jQuery,window);(function(d,w){var e={},z={i18n:{gameType:{standard:"\u6807\u51c6\u76d8",concedepoints:"\u8ba9\u7403",bigsmall:"\u5927\u5c0f\u7403",sigledouble:"\u5355\u53cc",redcard:"\u7ea2\u724c",whole:"\u5168\u573a",half:"\u534a\u573a"},trade:{big:"\u5927\u7403",small:"\u5c0f\u7403"},top:{first:"\u4e0a\u534a\u573a",second:"\u4e0b\u534a\u573a",half:"\u534a\u573a",playing:"\u8fdb\u884c\u4e2d",pause:"\u4e2d\u573a"},playlist:{title:this.tit,buy:"\u4e0b\u6ce8\uff08\u4e70\uff09",sell:"\uff08\u5356\uff09\u5403\u8d27",
refresh:"\u5237\u65b0",pkxm:"\u73a9\u6cd5",pk:"\u76d8\u53e3",pl:"\u53c2\u8003\u8d54\u7387"}}},c={firstGetPlaylist:function(){y.stopTimeout();c.ajax({url:e.playlist[0],success:function(a){0==a.c&&(b._addType(a.d),c.getAll())}})},getAll:function(){var a={p:b.getDefaultType()};c.ajax({url:e.allData,data:a,success:function(a){0==a.c&&(b.all(a.d),c.getIncrease(a.v))}})},getIncrease:function(a){c.getFrameInfo(a);c.getGameInfo(a);c.getMarketInfo(a);c.getPlaylist()},getPlaylist:function(){var a=arguments.callee,
f=e.playlist[1]||3E4;c.ajax({url:e.playlist[0],success:function(r){0==r.c&&(b._addType(r.d),c.timeoutIndex.playlist=setTimeout(a,f))}})},getFrameInfo:function(a){var f=arguments.callee,r=a||f.v,l=e.frameInfo[1]||3E3;c.ajax({url:e.frameInfo[0],data:{p:b.getDefaultType(),v:r},success:function(a){0==a.c&&(b.setFrame(a.d),f.v=a.v,c.timeoutIndex.frameInfo=setTimeout(f,l))}})},getGameInfo:function(a){var f=arguments.callee,r=a||f.v,l=e.gameInfo[1]||3E3;c.ajax({url:e.gameInfo[0],data:{p:b.getDefaultType(),
v:r},success:function(a){0==a.c&&(b.setStatus(a.d),f.v=a.v,c.timeoutIndex.gameInfo=setTimeout(f,l))}})},getMarketInfo:function(a){var f=arguments.callee,r=a||f.v,l=e.marketInfo[1]||3E3;c.ajax({url:e.marketInfo[0],data:{p:b.getDefaultType(),v:r},success:function(a){0==a.c&&(b.setStatus(a.d),f.v=a.v,c.timeoutIndex.marketInfo=setTimeout(f,l))}})},timeoutIndex:{},ajax:function(a){console.log(a.url,a.data);return d.ajax(d.extend({type:"post",dataType:"json"},a))}},b={all:function(a){b.setFrame(a[0][0]);
b.setStatus(a[1][0]);b.setPk(a[2])},setFrame:function(a){if(a){var f=a[7];b.setTop(a[4],a[6],a[9]);f&&b.setGames(f)}},setStatus:function(a){if(a){var f={},c,l=a[1],d={41:"",42:e.i18n.top.pause,43:""};c=b._handlerGoalRed(a[5]);f.mStatus=l;f.showHalfScore=/4[23]/.test(l)||!1;/4[123]/.test(l)&&(f.statusStr=d[l]);l=h.date2String;f.livetime=a[2]?l(new Date,"yyyy-MM-dd ")+l(new Date(a[2]+288E5),"HH:mm"):"";f.playTime=a[7]/6E4|0;f.p1goal=g.host.get("goal");f.p2goal=g.custom.get("goal");f.p1halfgoal=g.host.get("halfGoal");
f.p2halfgoal=g.custom.get("halfGoal");u.update(f);k.reset(c)}},_handlerGoalRed:function(a){var f=[],c,b,e,d,h,s,j=0;if(a)for(var p=0;2>p;p++){d=a[p];s=d[0];c=g.getById(s);s=c.hostcustomId();b=d[3]||[];for(n=b.length;n--;)h=b[n][0],(e=b[n][1])&&++j,f.push({id:"g"+s+n,action:"goal",type:p,time:h});c.set("goal",d[1]);c.set("redcard",d[2]);c.set("halfGoal",j);d=d[4]||[];for(var n=d.length;n--;)f.push({id:"r"+s+n,action:"red_card",type:p,time:d[n][0]})}return f},setPk:function(a){if(a)for(var f,c,b,e=
a.length,d="tradeId pdata b1 b1n b2 b2n b3 b3n s1 s1n s2 s2n s3 s3n".split(" "),g=d.length;e--;)if(c=a[e],f=c[0],f=A.getById(f)){b={};for(var h=0;h<g;h++)b[d[h]]=c[h];f.update(b)}},setTop:function(a,f,c){var b,e,d;d=g;f&&(b=f[0],e=f[1],f=b[2],0==d.length&&(b=d.create({playerId:b[0],name:b[1],isHost:b[2]}),e=d.create({playerId:e[0],name:e[1],isHost:e[2]}),d.host=f?b:e,d.custom=f?e:b));f=d.host;d=d.custom;u.set({isRollingBall:a,p1name:f.get("name"),p2name:d.get("name"),totalTime:c||90})},setGames:function(a){var f,
c,d,h,g,j,s,k,p=[],n=e.i18n.gameType,q=b.getDefaultType();for(f in n)p.push(n[f]);p=0;for(n=a.length;p<n;p++)if(f=a[p],h=f[1],d=f[2],c=f[3],j=f[4],s=f[5],g=f[6],c==q){k=v.getById(c);k=k.getGameModels(g);if(!k)break;g=k.getById(d);null==g&&(g=k.create({gameId:d}),k.showhide(e.gameType[0]==c));j={1:j,"0":"-",o:j,u:""};d=A.getById(h);f={tradeId:h,typeId:c,name:f[0],pk:j[s]};d?g.update(f):(d=new B,d.set(f),g.addTrade(d))}},firstAddType:function(a){0==a.c&&(b._addType(a.d),b.gecth(e))},addType:function(a){0==
a.c&&b._addType(a.d)},_addType:function(a){var f=e.i18n.gameType,c={1:"standard",2:"concedepoints",3:"bigsmall",4:"sigledouble"};if(a){e.gameType=a;for(var b,d,g=0,h=a.length;g<h;g++)b=a[g],(d=v.getById(b))||v.create({typeId:b,typeName:f[c[b]],isShow:0==g})}},getDefaultType:function(){return e.gameType[0]}},y={stopTimeout:function(){var a=c.timeoutIndex,f,b;for(b in a)a[b]&&clearTimeout(a[b]),f="get"+b.replace(/\w/,b.charAt(0).toUpperCase()),c[f]&&(c[f].v=void 0)}},h={date2String:function(a,f){f=
f||"yyyy-MM-dd HH:mm:ss";var c={dd:a.getDate(),MM:a.getMonth(),yyyy:a.getFullYear(),HH:a.getHours(),mm:a.getMinutes(),ss:a.getSeconds()},b;for(b in c)f=f.replace(b,c[b]);return f}},g=new sgfmmvc.Models({model:sgfmmvc.Model.extend({defaults:{goal:0,halfGoal:0},idArr:"playerId",hostcustomId:function(){return this.get("isHost")?1:2}})}),j=sgfmmvc.Model.extend({idArr:"gameId",addTrade:function(a){A.add(a)}}),t=sgfmmvc.Models.extend({model:j,isShow:!1,showhide:function(a){this.isShow=a}}),k=new sgfmmvc.Models({model:sgfmmvc.Model.extend()}),
x=sgfmmvc.View.extend({tag:"span",init:function(){var a=this.model,f=a.get("action")+"_"+["t","d"][a.get("type")];this.$.addClass(f).css("left",a.get("left"))},showTime:function(){d(this).show()},hideTime:function(){d(this).hide()},render:function(){var a=this.model.get("time");this.$.html(a+"'");return this}}),q=sgfmmvc.View.extend({model:k,cls:"play_time_bar",template:d("#timebar_tmpl").html(),init:function(){this.render();this.listenTo(this.model,"reset",this.reset)},render:function(){this.$.html(this.template);
var a=this.$.children();this.first=a.eq(0);this.second=a.eq(1);this.width=this.first.width();this.showTimeLine(u.get("playTime"),u.get("totalTime"))},showTimeLine:function(a,f){var c=this.first.children(".time_line"),b=this.width,d=f/2|0;a>d&&(c.css("width",b),a-=d,c=this.second.children(".time_line"));c.css("width",a/d*b|0).html(a+"'")},reset:function(){this.render();for(var a,c=this.width,b,d,e=document.createDocumentFragment(),g=document.createDocumentFragment(),h=this.model.toArr(),j=h.length;j--;)b=
h[j],a=b.get("time"),45>=a?d=e:45<a&&(a-=45,d=g),a=-10+a/45*c|0,b.set("left",a),b=new x({model:b}),d.appendChild(b.render().$[0]);this.first.append(e);this.second.append(g)}}),u=new sgfmmvc.Model,D=sgfmmvc.View.extend({model:u,init:function(){this.i18n=e.i18n.top;this.listenTo(this.model,"change:isRollingBall",this._init);this.listenTo(this.model,"update",this.render)},showhalf:function(){},_init:function(a,c,b){this.$.removeClass(["gq_top","ds_top"][b]).addClass(["ds_top","gq_top"][b]);this.template=
d(["#dstop_tmpl","#gqtop_tmpl"][b]).html();b&&(this.timebar=d("<div></div>"),new q({$:this.timebar}),this.$.append(this.timebar))},render:function(){var a=sgfmmvc.replace(this.template,d.extend({},this.model.getAttrs(),this.i18n));this.$.html(a).append(this.timebar);this.model.get("showHalfScore")||this.$.find(".p_helf_ac").hide();return this}}),B=sgfmmvc.Model.extend({idArr:"tradeId"}),A=new sgfmmvc.Models({model:B}),E=sgfmmvc.View.extend({tag:"li",template:d("#trade_tmpl").html(),init:function(){this.listenTo(this.model,
"hasChange",this.render)},events:{"a click":function(){alert(d(this).html())}},render:function(){var a=this.$;this.model.get("typeId");var b=this.model.get("name");/(big|small)/.test(b)?this.model.set("nameStr",e.i18n.trade[b]):this.model.set("nameStr",g.getById(b).get("name"));b=sgfmmvc.replace(this.template,this.model.getAttrs());a.html(b);return this}}),F=sgfmmvc.View.extend({cls:"play_list_ul",tag:"ul",template:d("#game_tmpl").html(),init:function(){this.listenTo(this.model,"addTrade",this.addTrade)},
render:function(){return this},addTrade:function(a){this.model.get(name);a=new E({model:a});this.$.append(a.render().$)}}),C=sgfmmvc.View.extend({cls:"play_list_frame",template:d("#playlist_tmpl").html(),init:function(){this.listenTo(this.model,"create",this.addGame);this.listenTo(this.model,"showhide",this.showhide)},addGame:function(a){a=this.model.getById(a.gameId);a=new F({model:a});this.$.append(a.render().$)},render:function(){var a=d.extend(e.i18n.playlist,{title:this.tit});this.$.hide().html(sgfmmvc.replace(this.template,
a));return this},showhide:function(a){a?0<this.model.length&&this.show():this.hide()}}),v=new sgfmmvc.Models({model:sgfmmvc.Model.extend({idArr:"typeId",showType:null,getGameModels:function(a){return{2:this.half,1:this.whole}[a]},getAllGameModels:function(){var a=[];this.half&&a.push(this.half);this.whole&&a.push(this.whole);return a},getShowType:function(){return this.showType},setShowType:function(a){this.getById(a.get(a.idArr))&&(this.showType=a)}})}),G=sgfmmvc.View.extend({template:d("#tab_tmpl").html(),
tag:"li",init:function(){this.cls="ons";this._init();this.listenTo(this.model,"change:isShow",this.showhide)},_init:function(){var a=sgfmmvc.replace(this.template,this.model.getAttrs());this.$.html(a)},render:function(){this.isShow()?this.highlight():this.removeHighlight();return this},clickTab:function(a){a.data.view.model.set("isShow",!0)},isShow:function(){return this.model.get("isShow")||!1},highlight:function(){this.$.addClass(this.cls);return this},removeHighlight:function(){this.$.removeClass(this.cls);
return this},showhide:function(a,b,c){this.render();a=this.model.getAllGameModels();for(b=a.length;b--;)a[b].showhide(c)}}),H=sgfmmvc.View.extend({model:v,cls:"other_play",init:function(){this.render();this.i18n=e.i18n.gameType;this.typeHandler={1:"standard",2:"concedepoints",3:"bigsmall",4:"sigledouble"};this.currenTab=null;this.listenTo(this.model,"create",this.addTypeTab)},events:{"li click":"toggleTab"},toggleTab:function(a){var b=d(this);a=a.data.view;if(a.currenTab){var c=a.currenTab.children().attr("typeId");
a.model.getById(c).set("isShow",!1)}c=b.children().attr("typeId");a.currenTab=b;a.model.getById(c).set("isShow",!0);a.setDefault(c)},setDefault:function(a){a=parseInt(a);for(var b=e.gameType,d=0,g=b.length;d<g;d++)if(a==b[d]){b.splice(d,1);b.unshift(a);break}c.firstGetPlaylist()},addTypeTab:function(a){var b=this.model.getById(a.typeId),b=new G({model:b});this.ul.append(b.render().$);a.isShow&&(this.currenTab=b.$)},render:function(){this.ul=d("<ul></ul>");this.$.append(this.ul);return this}}),I=sgfmmvc.View.extend({model:v,
init:function(){this.i18n=e.i18n.gameType;this.typeHandler={1:"standard",2:"concedepoints",3:"bigsmall",4:"sigledouble"};this.listenTo(this.model,"create",this.render)},render:function(a){a&&this.addGameType(a)},addGameType:function(a){a=a.typeId||a.get("typeId");var b=this.typeHandler[a];b&&this[b](a,b);return this},standard:function(){},concedepoints:function(a,b){b=this.i18n[b];var c=new C({tit:this.i18n.whole+"-"+b,model:new t}),d=new C({tit:this.i18n.half+"-"+b,model:new t}),e=this.model.getById(a);
e.half=d.model;e.whole=c.model;this.$.append(c.render().$,d.render().$)},bigsmall:function(a,b){this.concedepoints(a,b)},sigledouble:function(){},standard:function(){}}),J=sgfmmvc.View.extend({cls:"ac_frame",init:function(){this.top=new D;this.tagContent=new I;this.tabs=new H;this.render();c.firstGetPlaylist()},render:function(){this.$.append(this.top.$,this.tabs.render().$,this.tagContent.$)}});d.fn.sgfmplay=function(a){d.extend(!0,e,z,a);new J({$:this});return this};w.tmatch={getGamingId:function(){},
getMatchId:function(){},getPlayId:function(){},getMatchName:function(){},getLeMatchName:function(){},getGamingState:function(){},getHostname:function(){},getNextname:function(){},isGiveBall:function(){},getTradeItemName:function(){},getFullTimeSign:function(){},getTradeItemNorm:function(){},getFullTimeName:function(){},getTradeIndexType:function(){},getMatchTypeId:function(){},getPlaySign:function(){}}})(jQuery,window);
