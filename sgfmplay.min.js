(function(e,l){var h=l.sgfmmvc=l.sgfmmvc||{},n=0;h.Model=function(c){c=c||{};var b=c.defaults||{};this.idArr="id";this.hasChange=e.noop;this.get=function(a){return b[a]};this.getAttrs=function(){return b};this.reset=function(a){b={};return this.set(a)};this.change=function(){};var g=function(a,d){if(a){var k,j,f,c=!1;"string"==typeof a?(k={})[a]=d:k=a;for(var e in k)j=b[e],f=k[e],j!=f&&(b[e]=f,c=!0,this.change(e,j,f));c&&this.hasChange.call(this);return this}};this.set=function(a,d){return g.call(this,
a,d)};this.update=function(a,d){return g.call(this,a,d)};this.fetch=function(a){var d=this,b=this.url,c=a||function(a){this.set(a)};b&&e.ajax({url:b,success:function(b){"function"==typeof a&&c.call(d,b)},dataType:"json"})};e.extend(this,c);b[this.idArr]||(b[this.idArr]=n++)};h.Models=function(c){var b={};this.length=0;this.model=null;this.init=e.noop;this.create=function(a){a=new this.model({defaults:a});return g.call(this,a)};var g=function(a){var d=a.get(a.idArr);b[d]||(b[d]=a,this.length++,this.listenTo(a,
"destroy",function(){this.del(a)}));return a};this.add=function(a){return g.call(this,a)};this.del=function(a){a=a.get(a.idArr);b[a]&&(delete b[a],this.length--);return this};this.empty=function(){b={};this.length=0};this.toArr=function(){var a=[],d;for(d in b)a.push(b[d]);return a};this.getById=function(a){return b[a]};this.get=function(a){var d=0;for(m in b)if(d++,d==a)return b[m]};this.reset=function(a){this.empty();for(var d=a.length;d--;)this.create(a[d]);return this};this.fetch=function(a){var d=
this,b=this.url;b&&e.ajax({url:b,success:function(b){"function"==typeof a&&a.call(d,b)},dataType:"json"})};this.listenTo=function(a,d,c){var j,f,g;j=a.get(a.idArr);g=this;b[j]&&(f=a[d]||e.noop,a[d]=function(){var a=f.apply(this,arguments);c.apply(g,arguments);return a})};e.extend(this,c);this.init.call(this,c)};h.View=function(c){var b=this,g={},a={};this.init=e.noop;this.$=e("<div></div>");this.render=e.noop;this.events={};this.show=function(){return this.$.show()};this.hide=function(){return this.$.hide()};
this.listenTo=function(d,c,j){if(d){var f,h;f=c.split(":");c=f[0];"change"==c&&(f=f[1])&&(a[f]=j);h=g[c]||(g[c]=d[c])||e.noop;d[c]=function(){var e,f;f=arguments[0];e=h.apply(d,arguments);(f="change"==c?a[f]:j)&&f.apply(b,arguments);return e}}};this.addEvents=function(){var a,b,c,f,e=this.events;for(c in e)a=c.split(" "),b=a[0],a=a[1],f=e[c],"string"==typeof f&&(f=this[f]),this.$.delegate(b,a,{view:this},f)};this._init=function(){e.extend(b,c);var a=this.tag;a&&(this.$=e("<"+a+"></"+a+">"));(a=this.cls)&&
this.$.addClass(a);this.template&&(this.template=this.template.replace(/[\r\n\t]/g,""));this.init.call(this,c);this.addEvents.call(this,c)};this._init()};h.Model.extend=h.Models.extend=h.View.extend=function(c){var b=this;return function(g){return new b(e.extend(c,g))}};h.replace=function(c,b){if(!b||!c)return"";b instanceof h.Model&&(b=b.getAttrs());return c.replace(/{(.*?)}/igm,function(c,a){var d=b[a];return void 0!=d?d:""})}})(jQuery,window);
(function(f,v){var g={},z={ratioClick:f.noop,typeChange:f.noop,REGNOTREMOVE:/^[1-8]|11$/,REGUNLOCK:/^[37]$/,i18n:{gameType:{standard:"\u6807\u51c6\u76d8",concedepoints:"\u8ba9\u7403",bigsmall:"\u5927\u5c0f\u7403",sigledouble:"\u5355\u53cc",redcard:"\u7ea2\u724c",whole:"\u5168\u573a",half:"\u534a\u573a"},trade:{big:"\u5927\u7403",small:"\u5c0f\u7403"},top:{first:"\u4e0a\u534a\u573a",second:"\u4e0b\u534a\u573a",half:"\u534a\u573a",playing:"\u8fdb\u884c\u4e2d",pause:"\u4e2d\u573a"},playlist:{title:this.tit,
buy:"\u4e0b\u6ce8\uff08\u4e70\uff09",sell:"\uff08\u5356\uff09\u5403\u8d27",refresh:"\u5237\u65b0",pkxm:"\u73a9\u6cd5",pk:"\u76d8\u53e3",pl:"\u53c2\u8003\u8d54\u7387"}}},h={firstGetPlaylist:function(){A.stopTimeout();h.ajax({url:g.playlist[0],success:function(a){0==a.c&&(e._addType(a.d),h.getAll())}})},getAll:function(){var a={p:q.getCurrentGameType()};h.ajax({url:g.allData,data:a,success:function(a){0==a.c&&(e.all(a.d),h.getIncrease(a.v))}})},getIncrease:function(a){h.getFrameInfo(a);h.getGameInfo(a);
h.getMarketInfo(a);h.getPlaylist()},getPlaylist:function(){var a=arguments.callee,b=g.playlist[1]||3E4;h.ajax({url:g.playlist[0],success:function(c){0==c.c&&(e._addType(c.d),h.timeoutIndex.playlist=setTimeout(a,b))}})},getFrameInfo:function(a){var b=arguments.callee,c=a||b.v,d=g.frameInfo[1]||3E3;h.ajax({url:g.frameInfo[0],data:{p:q.getCurrentGameType(),v:c},success:function(a){0==a.c&&(a.d&&e.setFrame(a.d[0]),b.v=a.v,h.timeoutIndex.frameInfo=setTimeout(b,d))}})},getGameInfo:function(a){var b=arguments.callee,
c=a||b.v,d=g.gameInfo[1]||3E3;h.ajax({url:g.gameInfo[0],data:{p:q.getCurrentGameType(),v:c},success:function(a){0==a.c&&(a.d&&e.setStatus(a.d),b.v=a.v,h.timeoutIndex.gameInfo=setTimeout(b,d))}})},getMarketInfo:function(a){var b=arguments.callee,c=a||b.v,d=g.marketInfo[1]||3E3;h.ajax({url:g.marketInfo[0],data:{p:q.getCurrentGameType(),v:c},success:function(a){0==a.c&&(a.d&&e.setPk(a.d[0]),b.v=a.v,h.timeoutIndex.marketInfo=setTimeout(b,d))}})},timeoutIndex:{},ajax:function(a){return f.ajax(f.extend({type:"post",
dataType:"text",cache:!1,dataFilter:function(a){return(new Function("return "+a))()}},a))}},e={all:function(a){e.setFrame(a[0][0]);e.setStatus(a[1][0]);e.setPk(a[2])},setFrame:function(a){if(a){var b=a[7];k.checkMatch(a[0])&&(e.setTop(a),b&&e.setGames(b))}},setStatus:function(a){if(a){var b={},c,d=a[0],j=a[1],p={41:"",42:g.i18n.top.pause,43:""};c=a[5];var B=a[6];k.checkMatch(d)&&(c=e._handlerGoalRed(c),e.setGameStatus(B),b.mStatus=j,b.matchId=d,b.showHalfScore=/4[23]/.test(j)||!1,/4[123]/.test(j)&&
(b.statusStr=p[j]),d=C.date2String,b.livetime=a[2]?d(new Date,"yyyy-MM-dd ")+d(new Date(a[2]+288E5),"HH:mm"):"",b.playTime=a[7]/6E4|0,b.p1goal=l.host.get("goal"),b.p2goal=l.custom.get("goal"),b.p1halfgoal=l.host.get("halfGoal"),b.p2halfgoal=l.custom.get("halfGoal"),k.update(b),w.reset(c))}},_handlerGoalRed:function(a){var b=[],c,d,j,p,g,f,h=0;if(a)for(var m=0;2>m;m++){p=a[m];f=p[0];c=l.getById(f);f=c.hostcustomId();d=p[3]||[];for(e=d.length;e--;)g=d[e][0],(j=d[e][1])&&++h,b.push({id:"g"+f+e,action:"goal",
type:m,time:g});c.set("goal",p[1]);c.set("redcard",p[2]);c.set("halfGoal",h);p=p[4]||[];for(var e=p.length;e--;)b.push({id:"r"+f+e,action:"red_card",type:m,time:p[e][0]})}return b},setGameStatus:function(a){for(var b,c,d=a.length;d--;)b=a[d][0],c=a[d][1],(b=t.getById(b))&&b.set({gStatus:c})},setPk:function(a){if(a){var b,c,d,j;d="tradeId pdata b2 b2n b1 b1n b0 b0n s0 s0n s1 s1n s2 s2n".split(" ");for(var p=d.length,g=0,f=a.length;g<f;g++)if(c=a[g],b=c[0],b=n.getById(b)){j={};for(var e=0;e<p;e++)j[d[e]]=
c[e];b.update(j)}}},setTop:function(a){var b,c,d,j,g=a[0],f=a[1],e=a[3],h=a[4];d=a[6];var m=a[8];a=a[9];j=l;0==j.length&&d&&(b=d[0],c=d[1],d=b[2],b=j.create({playerId:b[0],name:b[1],isHost:b[2]}),c=j.create({playerId:c[0],name:c[1],isHost:c[2]}),j.host=d?b:c,j.custom=d?c:b);d=j.host;j=j.custom;k.set({matchTypeId:m,leagueName:e,matchId:g,matchName:f,isRollingBall:h,p1name:d.get("name"),p2name:j.get("name"),totalTime:a||90})},setGames:function(a){var b,c,d,j,f,e,h,k,m;d=[];var l=g.i18n.gameType,r=q.getCurrentGameType(),
s;for(s in l)d.push(l[s]);l=0;for(s=a.length;l<s;l++)if(b=a[l],name=b[0],j=b[1],d=b[2],c=b[3],f=b[4],e=b[5],b=b[6],c==r){k=q.getById(c);m=k.getGameModels(b);if(!m)break;k=m.getById(d);null==k&&(k=m.create({gameId:d}),m.showhide(r==c));h={1:f,"0":"",o:f,u:""};m=n.getById(j);c={tradeId:j,gameId:d,typeId:c,isWhole:b,indicator:f,name:name,concedeId:e,pk:h[e]};m?k.update(c):k.get("gameId")==d&&(m=new x,m.set(c),k.addTrade(m))}},firstAddType:function(a){0==a.c&&(e._addType(a.d),e.gecth(g))},addType:function(a){0==
a.c&&e._addType(a.d)},_addType:function(a){var b=q,c=g.i18n.gameType,d={1:"standard",2:"concedepoints",3:"bigsmall",4:"sigledouble"};if(a){b.getCurrentGameType()||b.setCurrentGameType(a[0]);g.currentGameType=g.currentGameType||a[0];for(var j,f,e=0,h=a.length;e<h;e++)j=a[e],(f=b.getById(j))||b.create({typeId:j,typeName:c[d[j]],isShow:0==e})}}},A={stopTimeout:function(){var a=h.timeoutIndex,b,c;for(c in a)a[c]&&clearTimeout(a[c]),b="get"+c.replace(/\w/,c.charAt(0).toUpperCase()),h[b]&&(h[b].v=void 0)}},
C={date2String:function(a,b){b=b||"yyyy-MM-dd HH:mm:ss";var c={dd:a.getDate(),MM:a.getMonth(),yyyy:a.getFullYear(),HH:a.getHours(),mm:a.getMinutes(),ss:a.getSeconds()},d;for(d in c)b=b.replace(d,c[d]);return b}},l=new sgfmmvc.Models({model:sgfmmvc.Model.extend({defaults:{goal:0,halfGoal:0},idArr:"playerId",hostcustomId:function(){return this.get("isHost")?1:2}})}),r=sgfmmvc.Model.extend({idArr:"gameId",addTrade:function(a){n.add(a)}}),u=sgfmmvc.Models.extend({model:r,isShow:!1,showhide:function(a){this.isShow=
a}}),t=new u,w=new sgfmmvc.Models({model:sgfmmvc.Model.extend()}),D=sgfmmvc.View.extend({tag:"span",init:function(){var a=this.model,b=a.get("action")+"_"+["t","d"][a.get("type")];this.$.addClass(b).css("left",a.get("left"))},showTime:function(){f(this).show()},hideTime:function(){f(this).hide()},render:function(){var a=this.model.get("time");this.$.html(a+"'");return this}}),E=sgfmmvc.View.extend({model:w,cls:"play_time_bar",template:f("#timebar_tmpl").html(),init:function(){this.render();this.listenTo(this.model,
"reset",this.reset)},render:function(){this.$.html(this.template);var a=this.$.children();this.first=a.eq(0);this.second=a.eq(1);this.width=this.first.width();this.showTimeLine(k.get("playTime"),k.get("totalTime"))},showTimeLine:function(a,b){var c=this.first.children(".time_line"),d=this.width,j=b/2|0;a>j&&(c.css("width",d),a-=j,c=this.second.children(".time_line"));c.css("width",a/j*d|0).html(a+"'")},reset:function(){this.render();for(var a,b=this.width,c,d,j=document.createDocumentFragment(),e=
document.createDocumentFragment(),f=this.model.toArr(),g=f.length;g--;)c=f[g],a=c.get("time"),45>=a?d=j:45<a&&(a-=45,d=e),a=-10+a/45*b|0,c.set("left",a),c=new D({model:c}),d.appendChild(c.render().$[0]);this.first.append(j);this.second.append(e)}}),k=new sgfmmvc.Model({checkMatch:function(a){var b=this.get("matchId");return b?b==a:!0}}),F=sgfmmvc.View.extend({model:k,init:function(){this.i18n=g.i18n.top;this.listenTo(this.model,"change:isRollingBall",this._init);this.listenTo(this.model,"change:p2name",
this.setTopFrameMatchName);this.listenTo(this.model,"update",this.render)},showhalf:function(){},_init:function(a,b,c){this.$.removeClass(["gq_top","ds_top"][c]).addClass(["ds_top","gq_top"][c]);this.template=f(["#dstop_tmpl","#gqtop_tmpl"][c]).html();c&&(this.timebar=f("<div></div>"),new E({$:this.timebar}),this.$.append(this.timebar))},render:function(){var a=sgfmmvc.replace(this.template,f.extend({},this.model.getAttrs(),this.i18n));this.$.html(a).append(this.timebar);this.model.get("showHalfScore")||
this.$.find(".p_helf_ac").hide();return this},setTopFrameMatchName:function(){var a,b,c;if(a=v.parent)b=this.model.get("p1name"),c=this.model.get("p2name"),a.$("#matchName").html(b+" VS "+c)}}),x=sgfmmvc.Model.extend({idArr:"tradeId"}),n=new sgfmmvc.Models({model:x}),G=sgfmmvc.View.extend({tag:"li",template:f("#trade_tmpl").html(),init:function(){this.listenTo(this.model,"hasChange",this.render)},events:{"a click":"ratioClick"},render:function(){var a=this.$;this.model.get("typeId");var b;b=this.model.get("name");
/(big|small)/.test(b)?this.model.set("nameStr",g.i18n.trade[b]):(b=l.getById(b))&&this.model.set("nameStr",b.get("name"));b=sgfmmvc.replace(this.template,this.model.getAttrs());a.html(b);return this},ratioClick:function(a){var b,c,d,e,h,k,l;a=a.data.view.model;b=f(this).attr("pos");d=a.get("tradeId");c=b.charAt(0);e={b:1,s:2}[c];h=b.charAt(1);h=parseInt(h);k=a.get(b)||"";b=a.get(b+"n")||"";l=0;if(0<h)for(var n=h;n--;)l+=parseInt(a.get(c+n+"n")||0);g.ratioClick({tradeItemId:d,tradeType:e,site:h,ratio:k,
qty:b,allQty:l,isFirstsd:!1})}}),H=sgfmmvc.View.extend({cls:"play_list_ul",tag:"ul",template:f("#game_tmpl").html(),init:function(){this.listenTo(this.model,"addTrade",this.addTrade);this.listenTo(this.model,"change:gStatus",this.changeGStatus)},render:function(){return this},addTrade:function(a){this.model.get(name);a=new G({model:a});this.$.append(a.render().$)},changeGStatus:function(a,b,c){this.model.get("gameId");b||(g.REGNOTREMOVE.test(c)?g.REGUNLOCK.test(c)?this.unlock():this.lock():this.model.destroy())},
unlock:function(){this.lock.show()},lock:function(){this.lock.hide()}}),y=sgfmmvc.View.extend({cls:"play_list_frame",template:f("#playlist_tmpl").html(),init:function(){this.listenTo(this.model,"create",this.addGame);this.listenTo(this.model,"showhide",this.showhide);this.listenTo(this.model,"del",this.removeView)},addGame:function(a){var b=this.model.getById(a.gameId);a=new H({model:b});t.add(b);b=f('<div class="lock_layout"></div>').hide();a.lock=b;this.$.append(a.render().$,b)},render:function(){var a=
f.extend(g.i18n.playlist,{title:this.tit});this.$.hide().html(sgfmmvc.replace(this.template,a));return this},showhide:function(a){a?0<this.model.length&&this.show():this.hide()},removeView:function(){0==this.model.length&&this.hide()}}),q=new sgfmmvc.Models({model:sgfmmvc.Model.extend({idArr:"typeId",getGameModels:function(a){return{2:this.half,1:this.whole}[a]},getAllGameModels:function(){var a=[];this.half&&a.push(this.half);this.whole&&a.push(this.whole);return a}}),currentGameType:null,getCurrentGameType:function(){return this.currentGameType},
setCurrentGameType:function(a){this.currentGameType=a}}),I=sgfmmvc.View.extend({template:f("#tab_tmpl").html(),tag:"li",init:function(){this.cls="selectTag";this._init();this.listenTo(this.model,"change:isShow",this.showhide)},_init:function(){var a=sgfmmvc.replace(this.template,this.model.getAttrs());this.$.html(a)},render:function(){this.isShow()?this.highlight():this.removeHighlight();return this},clickTab:function(a){a.data.view.model.set("isShow",!0)},isShow:function(){return this.model.get("isShow")||
!1},highlight:function(){this.$.addClass(this.cls);return this},removeHighlight:function(){this.$.removeClass(this.cls);return this},showhide:function(a,b,c){this.render();a=this.model.getAllGameModels();for(b=a.length;b--;)a[b].showhide(c)}}),J=sgfmmvc.View.extend({model:q,cls:"other_play",init:function(){this.i18n=g.i18n.gameType;this.typeHandler={1:"standard",2:"concedepoints",3:"bigsmall",4:"sigledouble"};this.currenTab=null;this.listenTo(this.model,"create",this.addTypeTab);this.listenTo(this.model,
"showhide",this.showhide)},events:{"li click":"toggleTab"},toggleTab:function(a){var b=f(this);a=a.data.view;if(a.currenTab){var c=a.currenTab.children().attr("typeId");a.model.getById(c).set("isShow",!1)}c=b.children().attr("typeId");a.currenTab=b;a.model.getById(c).set("isShow",!0);q.setCurrentGameType(c);h.firstGetPlaylist()},addTypeTab:function(a){var b=this.model.getById(a.typeId),b=new I({model:b});this.ul.append(b.render().$);a.isShow&&(this.currenTab=b.$)},render:function(){this.ul=f("<ul></ul>");
this.$.append(this.ul);return this},showhide:function(a,b,c){c?this.show():this.hide()}}),K=sgfmmvc.View.extend({model:q,init:function(){this.i18n=g.i18n.gameType;this.typeHandler={1:"standard",2:"concedepoints",3:"bigsmall",4:"sigledouble"};this.listenTo(this.model,"create",this.render)},render:function(a){a&&this.addGameType(a)},addGameType:function(a){a=a.typeId||a.get("typeId");var b=this.typeHandler[a];b&&this[b](a,b);return this},standard:function(){},concedepoints:function(a,b){b=this.i18n[b];
var c=new y({tit:this.i18n.whole+"-"+b,model:new u}),d=new y({tit:this.i18n.half+"-"+b,model:new u}),e=this.model.getById(a);e.half=d.model;e.whole=c.model;this.$.append(c.render().$,d.render().$)},bigsmall:function(a,b){this.concedepoints(a,b)},sigledouble:function(){},standard:function(){}}),L=sgfmmvc.View.extend({cls:"ac_frame",init:function(){this.top=new F;this.tagContent=new K;this.tabs=new J;this.render();h.firstGetPlaylist()},render:function(){this.$.append(this.top.$,this.tabs.render().$,
this.tagContent.$)}});f.fn.sgfmplay=function(a){f.extend(!0,g,z,a);new L({$:this});return this};r=v.parent;r=r.tmatch=r.tmatch||{};f.extend(r,{getGamingId:function(a){return n.getById(a).get("gameId")},getMatchId:function(){return k.get("matchId")},getPlayId:function(a){return n.getById(a).get("typeId")},getMatchName:function(){return k.get("matchName")},getLeMatchName:function(){return k.get("leagueName")},getGamingState:function(a){n.getById(a);a=tm.get("gameId");return t.getById(a).get("gStatus")},
getHostname:function(a){a=n.getById(a).get("name");return(a=isNaN(parseInt(a))?l.host:l.getById(a))&&a.get("name")||""},getNextname:function(a){a=n.getById(a).get("name");return(a=isNaN(parseInt(a))?l.custom:l.getById(a))&&a.get("name")||""},isGiveBall:function(a){return n.getById(a).get("concedeId")},getTradeItemName:function(a){return n.getById(a).get("nameStr")},getFullTimeSign:function(a){return n.getById(a).get("isWhole")},getTradeItemNorm:function(a){return n.getById(a).get("indicator")||""},
getFullTimeName:function(a){var b;b=g.i18n.gameType;a=n.getById(a).get("isWhole");return{1:b.whole,2:b.half}[a]},getTradeIndexType:function(a){return n.getById(a).get("tradeIndexType")},getMatchTypeId:function(){return k.get("matchTypeId")},getPlaySign:function(){return k.get("isRollingBall")}})})(jQuery,window);
